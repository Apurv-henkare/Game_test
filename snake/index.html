<!doctype html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">

<title>SPACE SHOOTER</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
  /* Critical for preventing browser gestures */
  touch-action: none; 
  position: fixed;
}

#canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  visibility: hidden;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}

/* Loader & Start Overlay */
#loader {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(180deg, #050520, #000010);
  color: white;
  z-index: 1000;
  transition: opacity 0.5s;
}

#logo {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(1rem, 5vw, 2rem);
  margin-bottom: 40px;
  color: #00ffe7;
  text-shadow: 0 0 15px #00ffe7;
}

#startBtn {
  display: none; /* Shown via JS when loaded */
  padding: 15px 30px;
  font-family: 'Press Start 2P', monospace;
  background: transparent;
  color: #ff6b6b;
  border: 4px solid #ff6b6b;
  cursor: pointer;
  font-size: 14px;
  margin-top: 20px;
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { opacity: 0.5; }
}

#barBox {
  width: 70%;
  max-width: 300px;
  height: 10px;
  background: #222;
  border-radius: 5px;
  overflow: hidden;
}

#bar {
  width: 0%;
  height: 100%;
  background: #00ffe7;
}

#status {
  margin-top: 15px;
  font-family: 'Press Start 2P', monospace;
  font-size: 8px;
  color: #00ffe7;
}

#rotatePrompt {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #000;
  color: white;
  font-family: 'Press Start 2P', monospace;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  text-align: center;
}

@media (orientation: portrait) {
  #rotatePrompt { display: flex; }
}
</style>
</head>

<body>

<div id="rotatePrompt">
  <div style="font-size: 40px; margin-bottom: 20px;">ðŸ“±â†»</div>
  <div style="font-size: 10px;">ROTATE TO LANDSCAPE</div>
</div>

<div id="loader">
  <div id="logo">SPACE SHOOTER</div>
  <div id="barBox"><div id="bar"></div></div>
  <div id="status">LOADING...</div>
  <button id="startBtn">TAP TO START</button>
</div>

<canvas id="canvas"></canvas>

<script>
// 1. Prevent all default browser gestures (scrolling, zooming, pull-to-refresh)
document.addEventListener('touchstart', (e) => {
    if (e.touches.length > 1) e.preventDefault(); 
}, { passive: false });

document.addEventListener('touchmove', (e) => {
    e.preventDefault();
}, { passive: false });

// 2. Fullscreen Logic
const loader = document.getElementById('loader');
const startBtn = document.getElementById('startBtn');
const canvas = document.getElementById('canvas');

function goFullScreen() {
    const docEl = document.documentElement;
    const requestMethod = docEl.requestFullscreen || 
                          docEl.webkitRequestFullScreen || 
                          docEl.mozRequestFullScreen || 
                          docEl.msRequestFullscreen;

    if (requestMethod) {
        requestMethod.call(docEl);
    }
    
    // Unlock Audio
    if (window.AudioContext || window.webkitAudioContext) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        ctx.resume();
    }

    loader.style.opacity = '0';
    setTimeout(() => {
        loader.style.display = 'none';
        canvas.style.visibility = 'visible';
        resizeCanvas();
    }, 500);
}

startBtn.addEventListener('click', goFullScreen);
startBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    goFullScreen();
});

// 3. Game Module Config
var Module = {
    arguments: ["./game.love"],
    INITIAL_MEMORY: 33554432,
    canvas: canvas,
    setStatus: function(text) {
        const status = document.getElementById("status");
        const barBox = document.getElementById("barBox");
        if (status) status.textContent = text;
        
        // When text is empty, it means LÃ–VE is ready
        if (!text || text === "") {
            status.style.display = "none";
            barBox.style.display = "none";
            startBtn.style.display = "block"; // Show the fullscreen trigger
        }
    },
    monitorRunDependencies: function(left) {
        const total = this.totalDependencies || 0;
        this.totalDependencies = Math.max(total, left);
        const percent = total ? Math.round(((this.totalDependencies - left) / this.totalDependencies) * 100) : 0;
        const bar = document.getElementById("bar");
        if (bar) bar.style.width = percent + "%";
    }
};

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

window.addEventListener("resize", resizeCanvas);
window.onerror = () => { document.getElementById("status").textContent = "LOAD ERROR"; };

function applicationLoad() { Love(Module); }
</script>

<script src="game.js"></script>
<script async src="love.js" onload="applicationLoad()"></script>

</body>
</html>