<!doctype html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">

<title>SPACE SHOOTER</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }

  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
    touch-action: none;
    position: fixed;
  }

  #canvas {
    display: block;
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    visibility: hidden;
    image-rendering: pixelated;
  }

  #loader {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #050510;
    z-index: 100;
    cursor: pointer;
  }

  #logo {
    font-family: 'Press Start 2P', cursive;
    font-size: clamp(20px, 5vw, 40px);
    color: #00ffe7;
    text-shadow: 0 0 10px #00ffe7;
    margin-bottom: 30px;
    text-align: center;
  }

  #status {
    font-family: 'Press Start 2P', cursive;
    font-size: 10px;
    color: #888;
    margin-bottom: 20px;
  }

  #barBox {
    width: 60%;
    max-width: 300px;
    height: 6px;
    background: #333;
    border-radius: 3px;
    margin-bottom: 20px;
    overflow: hidden;
  }

  #bar {
    width: 0%;
    height: 100%;
    background: #ff6b6b;
    transition: width 0.2s;
  }

  #tapHint {
    display: none;
    font-family: 'Press Start 2P', cursive;
    font-size: 12px;
    color: #fff;
    animation: blink 1s infinite;
  }

  @keyframes blink { 50% { opacity: 0.5; } }

  #rotatePrompt {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    z-index: 999;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-family: 'Press Start 2P', cursive;
  }

  @media screen and (orientation: portrait) {
    #rotatePrompt { display: flex; }
  }
</style>
</head>

<body>

  <div id="rotatePrompt">
    <div style="font-size: 40px; margin-bottom: 20px;">â†»</div>
    <div style="font-size: 12px;">ROTATE TO PLAY</div>
  </div>

  <div id="loader" onclick="startGame()">
    <div id="logo">SPACE SHOOTER</div>
    <div id="status">LOADING...</div>
    <div id="barBox"><div id="bar"></div></div>
    <div id="tapHint">TAP TO START FULLSCREEN</div>
  </div>

  <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const loader = document.getElementById("loader");
    const tapHint = document.getElementById("tapHint");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);

    // --- FULLSCREEN & START ---
    function startGame() {
      if (tapHint.style.display !== "block") return;

      const el = document.documentElement;
      const rfs = el.requestFullscreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullscreen;
      if (rfs) rfs.call(el).catch(() => {});

      // Audio unlock
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (AudioContext) { new AudioContext().resume(); }

      loader.style.display = "none";
      canvas.style.visibility = "visible";
      resize();

      // IMPORTANT: Push a state so the next 'back' button press works as intended
      history.pushState({playing: true}, "");
    }

    // --- BACK BUTTON LOGIC ---
    window.onpopstate = function() {
      // When user presses phone back button, go to main menu
      window.location.href = "../index.html";
    };

    // --- MULTI-TOUCH FIXES ---
    window.addEventListener('touchstart', e => {
      if (e.target === canvas) e.preventDefault();
    }, { passive: false });
    
    window.addEventListener('touchmove', e => {
      if (e.target === canvas) e.preventDefault();
    }, { passive: false });

    // --- LOVE.JS ENGINE ---
    var Module = {
      arguments: ["./game.love"],
      INITIAL_MEMORY: 33554432,
      canvas: canvas,
      setStatus: function(text) {
        document.getElementById("status").textContent = text;
        if (!text) {
          document.getElementById("barBox").style.display = "none";
          document.getElementById("status").style.display = "none";
          tapHint.style.display = "block";
        }
      },
      monitorRunDependencies: function(left) {
        const total = this.totalDependencies || 0;
        const percent = total ? ((total - left) / total) * 100 : 0;
        document.getElementById("bar").style.width = percent + "%";
      }
    };
  </script>
  
  <script src="game.js"></script>
  <script async src="love.js" onload="Love(Module)"></script>

</body>
</html>