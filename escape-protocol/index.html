<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <meta name="format-detection" content="telephone=no">

  <title>SPACE SHOOTER</title>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      touch-action: none !important;
      position: fixed;
      top: 0;
      left: 0;
    }

    #canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      visibility: hidden;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      touch-action: none;
      transform: translateZ(0); /* Hardware acceleration */
    }

    /* Loader */
    #loader {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle, #0a0a2e 0%, #000000 100%);
      z-index: 100;
      cursor: pointer;
      touch-action: manipulation;
    }

    #logo {
      font-family: 'Press Start 2P', cursive;
      font-size: clamp(18px, 5vw, 36px);
      color: #00ffe7;
      text-shadow: 0 0 15px #00ffe7;
      margin-bottom: 40px;
      text-align: center;
    }

    #status {
      font-family: 'Press Start 2P', cursive;
      font-size: 9px;
      color: #888;
      margin-bottom: 20px;
    }

    #barBox {
      width: 60%;
      max-width: 280px;
      height: 8px;
      background: #222;
      border-radius: 4px;
      margin-bottom: 30px;
      overflow: hidden;
      border: 1px solid #333;
    }

    #bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #00ffe7, #ff6b6b);
      transition: width 0.2s;
    }

    #tapHint {
      display: none;
      font-family: 'Press Start 2P', cursive;
      font-size: 11px;
      color: #fff;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    /* Rotate Prompt */
    #rotatePrompt {
      display: none;
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 999;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: 'Press Start 2P', cursive;
      touch-action: none;
    }

    @media screen and (orientation: portrait) {
      #rotatePrompt { display: flex; }
    }
  </style>
</head>

<body>

  <div id="rotatePrompt">
    <div style="font-size: 40px; margin-bottom: 20px;">ðŸ“±â†»</div>
    <div style="font-size: 10px;">ROTATE TO LANDSCAPE</div>
  </div>

  <div id="loader">
    <div id="logo">SPACE SHOOTER</div>
    <div id="status">LOADING ASSETS...</div>
    <div id="barBox"><div id="bar"></div></div>
    <div id="tapHint">TAP TO START CHAMP</div>
  </div>

  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const loader = document.getElementById("loader");
    const tapHint = document.getElementById("tapHint");
    let gameStarted = false;
    let fullscreenTriggered = false;

    // Global touch blocking (prevent scroll/zoom but allow events to reach canvas)
    const blockOptions = { passive: false, capture: true };

    function blockDefault(e) {
      e.preventDefault();
    }

    ['touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(evt => {
      document.addEventListener(evt, blockDefault, blockOptions);
    });

    document.addEventListener('contextmenu', e => e.preventDefault(), blockOptions);
    document.addEventListener('dblclick', e => e.preventDefault(), blockOptions);

    // Resize handler
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.width = '100vw';
      canvas.style.height = '100vh';
      if (!fullscreenTriggered) tryFullscreen();
    }

    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', () => setTimeout(resizeCanvas, 200));

    // Aggressive fullscreen on the CANVAS itself (better for games on mobile Chrome/Android)
    function tryFullscreen() {
      if (fullscreenTriggered || !canvas) return;

      const methods = [
        canvas.requestFullscreen,
        canvas.webkitRequestFullscreen,      // Older Android Chrome
        canvas.mozRequestFullScreen,         // Firefox
        canvas.msRequestFullscreen           // IE/Edge
      ];

      for (const method of methods) {
        if (typeof method === 'function') {
          method.call(canvas)
            .then(() => {
              fullscreenTriggered = true;
              console.log('Fullscreen activated on canvas');
            })
            .catch(err => console.warn('Fullscreen failed:', err));
          break;
        }
      }
    }

    // Start game logic
    function startGame() {
      if (tapHint.style.display !== "block") return;

      // Request fullscreen immediately on user gesture
      tryFullscreen();

      // Lock to landscape on supported devices (Android Chrome works well)
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape-primary').catch(err => {
          console.warn('Orientation lock failed:', err);
        });
      }

      // Audio unlock
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (AudioContext) new AudioContext().resume();

      loader.style.display = "none";
      canvas.style.visibility = "visible";
      gameStarted = true;
      resizeCanvas();

      // History for back button
      history.pushState({playing: true}, "");
    }

    // Detect exit fullscreen or resize out of fullscreen
    window.addEventListener('resize', () => {
      const isFullscreen = !!(
        document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement ||
        document.msFullscreenElement ||
        document.webkitIsFullScreen ||
        document.mozFullScreen
      );

      if (gameStarted && !isFullscreen) {
        window.location.href = "../index.html";
      }
    });

    window.onpopstate = () => { window.location.href = "../index.html"; };

    // Loader start triggers
    loader.addEventListener('click', startGame);
    loader.addEventListener('touchstart', startGame, { passive: false });

    // LÃ–VE.js Module
    var Module = {
      arguments: ["./game.love"],
      INITIAL_MEMORY: 33554432,
      canvas: canvas,
      setStatus: function(text) {
        const s = document.getElementById("status");
        if (s) s.textContent = text;
        if (!text) {
          document.getElementById("barBox").style.display = "none";
          if (s) s.style.display = "none";
          tapHint.style.display = "block";
          // Try fullscreen again after load (will only work if user taps anyway)
          tryFullscreen();
        }
      },
      monitorRunDependencies: function(left) {
        const total = this.totalDependencies || 0;
        const percent = total ? ((total - left) / total) * 100 : 0;
        document.getElementById("bar").style.width = percent + "%";
      }
    };
  </script>

  <script src="game.js"></script>
  <script async src="love.js" onload="Love(Module)"></script>

</body>
</html>